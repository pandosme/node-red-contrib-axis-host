<script type="text/x-red" data-template-name="Objects">
	<div class="form-row">
        <label for="node-input-output"><i class="icon-tag"></i> Output</label>
        <select id="node-input-output">
            <option value="1">Detections</option>
            <option value="2">Trackers</option>
            <option value="3">Paths</option>
		</select>
	</div>
	<div class="form-row">
        <label for="node-input-classFilter"><i class="icon-tag"></i> Detect</label>
        <select id="node-input-classFilter">
            <option value="-1">Everything</option>
            <option value="0">Human</option>
            <option value="1">Car</option>
            <option value="2">Truck</option>
            <option value="3">Bus</option>
            <option value="4">Bike</option>
            <option value="5">(Other)Vehicle</option>
            <option value="6">Face</option>
            <option value="7">License plate</option>
            <option value="8">Undefined</option>
		</select>
	</div>
	<div class="form-row">
        <label for="node-input-confidence"><i class="icon-tag"></i> Confidence</label>
        <select id="node-input-confidence">
            <option value="0">Any</option>
            <option value="10">10 or more</option>
            <option value="20">20 or more</option>
            <option value="30">30 or more</option>
            <option value="40">40 or more</option>
            <option value="50">50 or more</option>
            <option value="60">60 or more</option>
            <option value="70">70 or more</option>
            <option value="80">80 or more</option>
            <option value="90">90 or more</option>
            <option value="100">100 or more</option>
            <option value="100">110 or more</option>
            <option value="100">120 or more</option>
            <option value="100">130 or more</option>
            <option value="100">140 or more</option>
		</select>
	</div>
	<div class="form-row">
        <label for="node-input-rotation"><i class="icon-tag"></i> Rotation</label>
        <select id="node-input-rotation">
            <option value="0">0</option>
            <option value="90">90</option>
            <option value="180">180</option>
            <option value="270">270</option>
		</select>
	</div>
	<div class="form-row">
        <label for="node-input-cog"><i class="icon-tag"></i> CoG</label>
        <select id="node-input-cog">
            <option value="0">Center of object</option>
            <option value="1">Middle-bottom (feet)</option>
		</select>
	</div>
</script>

<script type="text/javascript">
RED.nodes.registerType('Objects',{
	category: 'Axis',
	color: '#FFCC33',
	defaults: {
		output: { value:"2"},
		classFilter: { value:"-1"},
		confidence: { value:"50"},
		rotation: { value:"0"},
		cog: { value:"0"}
	},
	icon: "font-awesome/fa-object-ungroup",
	inputs:0,
	outputs:1,
	label: function() {
		var text = "";
		if( this.output == "1")
			text += "Detections: ";
		if( this.output == "2")
			text += "Trackers: ";
		if( this.output == "3")
			text += "Paths: ";
		if( this.classFilter == "-1" )
			text += "Everything";
		if( this.classFilter == "0" )
			text += "Human";
		if( this.classFilter == "1" )
			text += "Car";
		if( this.classFilter == "2" )
			text += "Truck";
		if( this.classFilter == "3" )
			text += "Bus";
		if( this.classFilter == "4" )
			text += "Bike";
		if( this.classFilter == "5" )
			text += "(Other)vehicle";
		if( this.classFilter == "6" )
			text += "Face";
		if( this.classFilter == "7" )
			text += "License plate";
		if( this.classFilter == "8" )
			text += "Undefined";
		return text;
	}
});
</script>

<script type="text/x-red" data-help-name="Objects">
<p>
Objects provides data from the cameras object detection analytics.
</p>
<h3>Configuration</h3>
<p>
	<b>Output</b><br/>
	Select Detections, Tracker or Path depending on the use case
</p>
<p>
	<b>Detect</b><br/>
	Select the object class depending on the use case
</p>
<p>
	<b>Confidence</b><br/>
	Set the minimum confidence level to suppress unwanted detections.  Look at the output confidence value to find a good level.
</p>
<p>
	<b>Rotation</b><br/>
	The analytics data has no sense of the camera rotation.  If the camera is mounted upsidedown you may need to set 180 degrees to align image/video to the data.  If the camera is rotated to "portrait mode", select 90 or 270 degrees, depending on the rotation direction.
</p>
<p>
	<b>CoG: Center of Gravity</b><br/>
	Defines the position of cx and cy.  Depending on use case and camera mounting you may want these values to be in the center of the bounding box or places at the center-bottom.
	If the camera is mounted in the ceiling, looking stright down you should use "Center".  If the camera is mounted on the wall, having a perspective view, select bottom (feet).
</p>


<h3>Coordindate system</h3>
<p>
The coordintate system is [0,0...1000,1000] regardless of camera aspect ratio.  The origo is in the top-left corner.
To map coordinate to pixels:
pixelX = (x / 1000) * image width;
pixelY = (y / 1000) * image height
<p>

<h3>Detections Output</h3>
<p>
Detection provides the raw unprocessed data from the cameras analytics.  This may provide huge amount of data.  Use this data with coution and only when Trackers or Paths are not able to solve the use case.
<pre>
id:			Unique ID of each object that can be used to tracker a specific object
type:		Values: Person, Vehicle or Other
class:		Values: Human, Car, Truck, Bus, Motorcycle, (Other)Vehicle, Face, License plate 
distance:	Distance traveled in percent of camera view.  Distance may be longer than 100% if object moves back and forth.
</pre>
</p>

<h3>Trackers Output</h3>
<p>
Trackers are update when an object has moved 5% or more of the camer view.  Trackers are optimal for real-time automation.  A motion detection logic can easily be accomplished cheching if the cx and cy values are withing a selected area.
<pre>
id:			Unique ID of each object that can be used to tracker a specific object
type:		Values: Person, Vehicle or Other
active:		true while the object is being tracked. false when object is lost (left scene)
class:		Values: Human, Car, Truck, Bus, Motorcycle, (Other)Vehicle, Face, License plate 
distance:	Distance traveled in percent of camera view.  Distance may be longer than 100% if object moves back and forth.
age:		Seconds the object has been in scene
birth:		Timestamp when the object was detected
timestamp:	Current/last timestamp
x:			Bounding box x position
y:			Bounding box y position	
w:			Bounding box width
h:			Bounding box height
cx:			Center of gravity X
cy:			Center of gravity X
bx:			Birth X (center of gravity)
by:			Birth y (center of gravity)
dx:			Total delta X movement from bx.  Negative value means left, positiv means right
dy:			Total delta Y movement from by.  Negative value means up, positiv means down
</pre>
</p>

</script>
